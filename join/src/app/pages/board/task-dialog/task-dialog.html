@if (!isHardClose) {
<div class="dialog-overlay" (click)="onOverlayClick($event)">
  <div class="content-container">
    <section
      #dialogEl
      class="dialog"
      [class.dialog--animated]="!disableEnterAnimation"
      [class.dialog--closing]="isClosing"
      [style.height.px]="fixedHeight"
      (click)="onDialogClick($event)"
    >
      @if (task$ | async; as task) {
      <!-- =========================
               HEADER (shared)
        ========================== -->
      <header [class.header--edit]="isEdit$ | async">
        @if (!(isEdit$ | async)) {
        <div
          class="badge"
          [class.badge--user-story]="task.category === 'user-story'"
          [class.badge--tech-task]="task.category === 'technical-task'"
        >
          {{ getCategoryLabel(task.category) }}
        </div>
        }

        <button class="close-btn" type="button" aria-label="Close dialog" (click)="close()">
          <img src="img/icons/close_black.svg" alt="" />
        </button>
      </header>

      <!-- =========================
               SCROLL AREA (shared)
        ========================== -->
      <section class="dialog-content" (click)="editCmp?.closeAssigneeDropdown()">
        <div class="dialog-content__inner">
          @if (isEdit$ | async) {
          <!-- =========================
                     EDIT MODE (placeholder)
              ========================== -->
          <app-task-dialog-edit [task]="task" [contacts]="contacts$ | async"></app-task-dialog-edit>

          } @else {
          <!-- =========================
                     VIEW MODE
              ========================== -->

          <h1 class="title">{{ task.title }}</h1>
          <p class="description">{{ task.description }}</p>

          <table class="date-prio-wrapper">
            <tr>
              <td class="label">Due date:</td>
              <td class="value">
                @if (task.dueDate) {
                {{ task.dueDate | date : 'dd/MM/yyyy' }}
                } @else {
                <span class="value value--muted">No due date</span>
                }
              </td>
            </tr>

            <tr>
              <td class="label">Priority:</td>
              <td class="value value--priority">
                <span class="priority-text">
                  {{ task.priority.toLowerCase() | titlecase }}
                </span>

                @if (task.priority.toLowerCase() === 'urgent') {
                <img src="img/icons/prio-urgent.svg" alt="" class="priority-icon" />
                } @else if (task.priority.toLowerCase() === 'medium') {
                <img src="img/icons/prio-medium.svg" alt="" class="priority-icon" />
                } @else if (task.priority.toLowerCase() === 'low') {
                <img src="img/icons/prio-low.svg" alt="" class="priority-icon" />
                }
              </td>
            </tr>
          </table>

          <div class="assignment">
            <span class="label">Assigned To:</span>

            @if (taskView$ | async; as taskView) {
            <div class="assigned">
              @if (taskView.task?.assignees?.length) { @for ( assignee of
              buildAssigneeViews(taskView.task!.assignees!, taskView.contactsById); track
              assignee.uid ) {
              <div class="assigned-item">
                <div class="circle" [style.background-color]="assignee.color">
                  {{ assignee.initials }}
                </div>
                <span class="name">{{ assignee.name }}</span>
              </div>
              } } @else {
              <span class="value value--muted">No assignees</span>
              }
            </div>
            }
          </div>

          <div class="subtasks">
            <h3 class="label">Subtasks</h3>

            @if (task.subtasks?.length) {
            <div class="subtasks-list">
              @for (subtask of task.subtasks; track subtask.id) {
              <label class="subtask">
                <input
                  class="subtask__check"
                  type="checkbox"
                  [checked]="subtask.done"
                  (change)="toggleSubtask(task, subtask)"
                />
                <span class="subtask__icon" aria-hidden="true"></span>
                <span class="subtask__title">{{ subtask.title }}</span>
              </label>
              }
            </div>
            } @else {
            <p class="value value--muted">No subtasks</p>
            }
          </div>
          }
        </div>
      </section>

      <!-- =========================
               FOOTER (mode-specific)
        ========================== -->
      @if (isEdit$ | async) {
      <footer class="actions actions--single">
        <button type="button" class="back-btn" (click)="onOk(task)">
          <span>Ok</span>
          <img src="img/icons/check-small.svg" aria-hidden="true" alt="" />
        </button>
      </footer>

      } @else {
      <footer class="actions">
        <button type="button" class="action-btn action-btn--delete" (click)="deleteTask(task)">
          <img src="img/icons/delete.svg" alt="" />
          <span>Delete</span>
        </button>

        <div class="separator"></div>

        <button type="button" class="action-btn action-btn--edit" (click)="openEdit(task)">
          <img src="img/icons/edit-hover.svg" alt="" />
          <span>Edit</span>
        </button>
      </footer>
      } } @else {
      <p>Task not found.</p>
      }
    </section>
  </div>
</div>
}
