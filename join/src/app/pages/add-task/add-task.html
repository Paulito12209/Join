@if (showTaskAddedToast) {
<div class="toast" [class.toast--hide]="hideToast">
  <span>Task added to board</span>
  <img src="img/icons/board-active.svg" alt="" />
</div>
}

<div class="add-task-page" [class.page--toast-lock]="showTaskAddedToast">
  <header class="page-header">
    <h1>Add Task</h1>
  </header>

  <form [formGroup]="taskForm" class="content">
    <div class="left">
      <label>Title<span>*</span></label>
      <input formControlName="title" placeholder="Enter a title" />
      <span class="error" *ngIf="taskForm.get('title')?.invalid && taskForm.get('title')?.touched">This field is
        required</span>

      <label>Description</label>
      <textarea formControlName="description" placeholder="Enter a Description"></textarea>

      <label>Due date<span>*</span></label>
      <input #dateInput type="date" formControlName="dueDate" placeholder="dd/mm/yyyy" required
        (click)="dateInput.showPicker()" />
      <span class="error" *ngIf="taskForm.get('dueDate')?.invalid && taskForm.get('dueDate')?.touched">This field is
        required</span>
    </div>

    <div class="right">
      <label>Priority</label>
      <div class="priority">
        <button type="button" class="prio-urgent" [class.active]="taskForm.value.priority === 'Urgent'"
          (click)="taskForm.patchValue({ priority: 'Urgent' })">
          Urgent <img src="img/icons/prio-urgent.svg" alt="Urgent" />
        </button>
        <button type="button" class="prio-medium" [class.active]="taskForm.value.priority === 'Medium'"
          (click)="taskForm.patchValue({ priority: 'Medium' })">
          Medium <img src="img/icons/prio-medium.svg" alt="Medium" />
        </button>
        <button type="button" class="prio-low" [class.active]="taskForm.value.priority === 'Low'"
          (click)="taskForm.patchValue({ priority: 'Low' })">
          Low <img src="img/icons/prio-low.svg" alt="Low" />
        </button>
      </div>

      <label>Assigned to</label>
      <div class="assignee-field" (click)="toggleAssigneeDropdown(true)" tabindex="0">
        <span class="placeholder"> Select contacts to assign </span>
        <img class="dropdown-arrow" [src]="assigneeOpen ? 'img/icons/dropup.svg' : 'img/icons/dropdown.svg'"
          (click)="$event.stopPropagation(); toggleAssigneeDropdown(!assigneeOpen)" />
      </div>

      <div class="assignee-avatars" *ngIf="(taskForm.value.assignedTo || []).length">
        <span class="avatar" *ngFor="let uid of taskForm.value.assignedTo" [style.background]="getContactColor(uid)"
          [title]="getContactName(uid)">
          {{ (getContactName(uid) || '?').slice(0, 1).toUpperCase() }}
        </span>
      </div>

      <div class="assigned-list dropdown" *ngIf="assigneeOpen">
        <label class="assigned-item" *ngFor="let person of contacts"
          [class.selected]="(taskForm.value.assignedTo || []).includes(person.id!)" (mousedown)="
            toggleAssignee(person.id!, !(taskForm.value.assignedTo || []).includes(person.id!))
          ">
          <span class="avatar" [style.background]="person.color || '#6c63ff'">
            {{ (person.name || '?').slice(0, 1).toUpperCase() }}
          </span>

          <span class="name">{{ person.name }}</span>

          <img class="checkbox-icon" [src]="
              (taskForm.value.assignedTo || []).includes(person.id!)
                ? 'img/icons/checkbox-done.svg'
                : 'img/icons/checkbox-todo.svg'
            " alt="checkbox" />
        </label>
      </div>

      <label>Category<span>*</span></label>

      <div class="select-wrapper">
        <select formControlName="category">
          <option value="">Select task category</option>
          <option value="user-story">User story</option>
          <option value="technical-task">Technical task</option>
        </select>

        <img class="dropdown-arrow select-arrow" src="img/icons/dropdown.svg" alt="dropdown" />
      </div>
      <span class="error" *ngIf="taskForm.get('category')?.invalid && taskForm.get('category')?.touched">This field is
        required</span>

      <label>Subtasks</label>

      <div class="subtask-input-wrapper">
        <input [(ngModel)]="newSubtaskTitle" [ngModelOptions]="{ standalone: true }" placeholder="Add new subtask"
          (focus)="subtaskFocus = true" (blur)="!newSubtaskTitle && (subtaskFocus = false)"
          (keydown.enter)="$event.preventDefault(); addSubtask()" />

        <span class="subtask-icons" *ngIf="subtaskFocus">
          <button type="button" class="icon-btn" (click)="clearSubtaskInput(); subtaskFocus = false">
            <img src="img/icons/close_black.svg" alt="Clear" />
          </button>

          <span class="divider"></span>

          <button type="button" class="icon-btn" (click)="addSubtask()">
            <img src="img/icons/check-hover.svg" alt="Add" />
          </button>
        </span>
      </div>

      <ul class="subtask-list">
        <li *ngFor="let s of subtasks">
          <span class="subtask-title">{{ s.title }}</span>

          <div class="item-actions">
            <button type="button" class="icon-btn" (click)="startEditSubtask(s.id, s.title)">
              <img src="img/icons/edit.svg" alt="Edit" />
            </button>

            <span class="divider-small"></span>

            <button type="button" class="icon-btn" (click)="removeSubtask(s.id)">
              <img src="img/icons/delete.svg" alt="Delete" />
            </button>
          </div>
        </li>
      </ul>
      <!-- Required-Hint fÃ¼r Mobile View (unter Subtasks) -->
      <span class="required-hint-mobile"><span class="asterisk">*</span>This field is required</span>
    </div>
  </form>

  <footer class="actions">
    <span class="required-hint"> <span class="asterisk">*</span>This field is required </span>

    <div class="action-buttons">
      <button class="clear" type="button" (click)="clearForm()">
        Clear
        <img class="btn-icon" src="img/icons/dialog_cancel.svg" alt="Clear" />
      </button>

      <button class="submit" [disabled]="taskForm.invalid" (click)="createTask()">
        Create Task
        <img class="btn-icon" src="img/icons/dialog_check.svg" alt="Create" />
      </button>
    </div>
  </footer>
</div>